import numpy as np
import biorbd_casadi as biorbd

from bioptim import PlotType, CostType
from casadi import horzcat


def plot_com(x, nlp):
    com_func = biorbd.to_casadi_func("CoMPlot", nlp.model.CoM, nlp.states["q"].mx, expand=False)
    com_dot_func = biorbd.to_casadi_func("Compute_CoM", nlp.model.CoMdot, nlp.states["q"].mx, nlp.states["qdot"].mx, expand=False)
    q = nlp.states["q"].mapping.to_second.map(x[nlp.states["q"].index, :])
    qdot = nlp.states["qdot"].mapping.to_second.map(x[nlp.states["qdot"].index, :])

    return np.concatenate((np.array(com_func(q)[2, :]), np.array(com_dot_func(q, qdot)[2, :])))


def add_custom_plots(ocp, jumper_ocp):
    for i, nlp in enumerate(ocp.nlp):
        ocp.add_plot(
            "tau_controls", lambda t, x, u, p: np.zeros((4, len(x[0]))), phase=i, plot_type=PlotType.STEP, color="k"
        )

        # Plot CoM pos and velocity
        ocp.add_plot("CoM", lambda t, x, u, p: plot_com(x, nlp), phase=i, legend=["CoM", "CoM_dot"])

        # Plot q and nb_qdot ranges
        ocp.add_plot(
            "q_states",
            lambda t, x, u, p: np.repeat(jumper_ocp.x_bounds[i].min[: jumper_ocp.n_q, 1][:, np.newaxis], x.shape[1], axis=1),
            phase=i,
            plot_type=PlotType.PLOT,
        )
        ocp.add_plot(
            "q_states",
            lambda t, x, u, p: np.repeat(jumper_ocp.x_bounds[i].max[: jumper_ocp.n_q, 1][:, np.newaxis], x.shape[1], axis=1),
            phase=i,
            plot_type=PlotType.PLOT,
        )
        ocp.add_plot(
            "qdot_states",
            lambda t, x, u, p: np.repeat(jumper_ocp.x_bounds[i].min[jumper_ocp.n_q:(jumper_ocp.n_q+jumper_ocp.n_q), 1][:, np.newaxis], x.shape[1], axis=1),
            phase=i,
            plot_type=PlotType.PLOT,
        )
        ocp.add_plot(
            "qdot_states",
            lambda t, x, u, p: np.repeat(jumper_ocp.x_bounds[i].max[jumper_ocp.n_q:(jumper_ocp.n_q+jumper_ocp.n_q), 1][:, np.newaxis], x.shape[1], axis=1),
            phase=i,
            plot_type=PlotType.PLOT,
        )
        # m = jumper_ocp.jumper.model
        # c = m.softContact(0)
        # nq = jumper_ocp.n_q
        # ns = jumper_ocp.jumper.n_shoot
        # ocp.add_plot(
        #     "contact",
        #     lambda t, x, u, p:
        #     horzcat([biorbd.SoftContactSphere(c).computeForceAtOrigin(m, x[:nq, i], x[nq:, i]).to_mx() for i in range(2)]),
        #     phase=i,
        #     plot_type=PlotType.PLOT,
        # )

#         q = sol.states['q'];
#         qdot = sol.states['qdot']
#         biorbd.SoftContactSphere(c).computeForceAtOrigin(m, q[:, 0], qdot[:, 0]).to_mx()
#
#         ocp.add_plot("contact_force", lambda t, x, u, p: q = sol.states['q']; qdot = sol.states['qdot']
#         biorbd.SoftContactSphere(c).computeForceAtOrigin(m,q[:,0],qdot[:,0]).to_mx()
#
# biorbd.SoftContactSphere(c).computeForceAtOrigin(m,q[:,0],qdot[:,0]).to_mx()
# biorbd.SoftContactSphere(c).computeForceAtOrigin(m,q[:,0],qdot[:,0]).to_mx()
# MX(@1=(zeros(3x1)[2] = 1), @2=(((zeros(3x1)[0] = -0.1)[1] = 0)[2] = 0), @3=cos(@2[0]), @4=sin(@2[0]), @5=cos(@2[1]), @6=sin(@2[1]), @7=cos(@2[2]), @8=sin(@2[2]), @9=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = @3))[5] = (-@4)))[2] = 0))[5] = @4))[8] = @3),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @5))[1] = 0))[2] = @6))[1] = 0))[3] = 1))[5] = 0))[2] = (-@6)))[5] = 0))[8] = @5),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @7))[1] = (-@8)))[2] = 0))[1] = @8))[3] = @7))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = (zeros(3x1)[2] = 0.8)), @10=@9[:9], @11=(dense((zeros(3x1,2nz)[1] = 1))[2] = 0), @12=(dense((project((zeros(6x1,4nz)[3] = @11[0]))[4] = @11[1]))[5] = @11[2]), @13=(dense((project((project((project((project((zeros(6x1,1nz)[0] = -0.085603))[1] = 0.606641))[2] = -0.0959401))[3] = 0.190916))[4] = -0.0248865))[5] = -0.645388), @14=(zeros(3x1)[2] = 1), @15=(dense((project((zeros(6x1,4nz)[3] = @14[0]))[4] = @14[1]))[5] = @14[2]), @16=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @17=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @16[0]))[1] = @16[1]))[2] = @16[2]))[3] = 0))[4] = 0))[5] = 0), @18=(dense((project((zeros(3x1,1nz)[0] = @17[0]))[1] = @17[1]))[2] = @17[2]), @19=@13[2], @20=cos(@19), @21=sin(@19), @22=mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@18[0])*(1-@20))+@20)))[1] = (((@18[1]*@18[0])*(1-@20))+(@18[2]*@21))))[2] = (((@18[0]*@18[2])*(1-@20))-(@18[1]*@21))))[1] = (((@18[0]*@18[1])*(1-@20))-(@18[2]*@21))))[3] = ((sq(@18[1])*(1-@20))+@20)))[5] = (((@18[1]*@18[2])*(1-@20))+(@18[0]*@21))))[2] = (((@18[0]*@18[2])*(1-@20))+(@18[1]*@21))))[5] = (((@18[1]*@18[2])*(1-@20))-(@18[0]*@21))))[8] = ((sq(@18[2])*(1-@20))+@20)),@10',zeros(3x3)), @23=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = ((zeros(3x1)[1] = 0.0406074)[2] = -0.104557)), @24=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @25=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @24[0]))[1] = @24[1]))[2] = @24[2]))[3] = 0))[4] = 0))[5] = 0), @26=(dense((project((zeros(3x1,1nz)[0] = @25[0]))[1] = @25[1]))[2] = @25[2]), @27=@13[3], @28=cos(@27), @29=sin(@27), @30=mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@26[0])*(1-@28))+@28)))[1] = (((@26[1]*@26[0])*(1-@28))+(@26[2]*@29))))[2] = (((@26[0]*@26[2])*(1-@28))-(@26[1]*@29))))[1] = (((@26[0]*@26[1])*(1-@28))-(@26[2]*@29))))[3] = ((sq(@26[1])*(1-@28))+@28)))[5] = (((@26[1]*@26[2])*(1-@28))+(@26[0]*@29))))[2] = (((@26[0]*@26[2])*(1-@28))+(@26[1]*@29))))[5] = (((@26[1]*@26[2])*(1-@28))-(@26[0]*@29))))[8] = ((sq(@26[2])*(1-@28))+@28)),@23[:9]',zeros(3x3)),@22,zeros(3x3)), @31=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = (zeros(3x1)[2] = -0.462839)), @32=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @33=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @32[0]))[1] = @32[1]))[2] = @32[2]))[3] = 0))[4] = 0))[5] = 0), @34=(dense((project((zeros(3x1,1nz)[0] = @33[0]))[1] = @33[1]))[2] = @33[2]), @35=@13[4], @36=cos(@35), @37=sin(@35), @38=mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@34[0])*(1-@36))+@36)))[1] = (((@34[1]*@34[0])*(1-@36))+(@34[2]*@37))))[2] = (((@34[0]*@34[2])*(1-@36))-(@34[1]*@37))))[1] = (((@34[0]*@34[1])*(1-@36))-(@34[2]*@37))))[3] = ((sq(@34[1])*(1-@36))+@36)))[5] = (((@34[1]*@34[2])*(1-@36))+(@34[0]*@37))))[2] = (((@34[0]*@34[2])*(1-@36))+(@34[1]*@37))))[5] = (((@34[1]*@34[2])*(1-@36))-(@34[0]*@37))))[8] = ((sq(@34[2])*(1-@36))+@36)),@31[:9]',zeros(3x3)),@30,zeros(3x3)), @39=(((zeros(3x1)[0] = 1.5708)[1] = 0)[2] = 0), @40=cos(@39[0]), @41=sin(@39[0]), @42=cos(@39[1]), @43=sin(@39[1]), @44=cos(@39[2]), @45=sin(@39[2]), @46=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = @40))[5] = (-@41)))[2] = 0))[5] = @41))[8] = @40),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @42))[1] = 0))[2] = @43))[1] = 0))[3] = 1))[5] = 0))[2] = (-@43)))[5] = 0))[8] = @42),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @44))[1] = (-@45)))[2] = 0))[1] = @45))[3] = @44))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = (zeros(3x1)[2] = -0.427481)), @47=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @48=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @47[0]))[1] = @47[1]))[2] = @47[2]))[3] = 0))[4] = 0))[5] = 0), @49=(dense((project((zeros(3x1,1nz)[0] = @48[0]))[1] = @48[1]))[2] = @48[2]), @50=@13[5], @51=cos(@50), @52=sin(@50), @53=(((((((dense((project((zeros(3x1,1nz)[0] = @9[9]))[1] = @9[10]))[2] = @9[11])+mac(@10,(dense((project((zeros(3x1,1nz)[0] = (@12[3]*@13[0])))[1] = (@12[4]*@13[0])))[2] = (@12[5]*@13[0])),zeros(3x1)))+mac(@10,(dense((project((zeros(3x1,1nz)[0] = (@15[3]*@13[1])))[1] = (@15[4]*@13[1])))[2] = (@15[5]*@13[1])),zeros(3x1)))+mac(@22',(dense((project((zeros(3x1,1nz)[0] = @23[9]))[1] = @23[10]))[2] = @23[11]),zeros(3x1)))+mac(@30',(dense((project((zeros(3x1,1nz)[0] = @31[9]))[1] = @31[10]))[2] = @31[11]),zeros(3x1)))+mac(@38',(dense((project((zeros(3x1,1nz)[0] = @46[9]))[1] = @46[10]))[2] = @46[11]),zeros(3x1)))+mac(mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@49[0])*(1-@51))+@51)))[1] = (((@49[1]*@49[0])*(1-@51))+(@49[2]*@52))))[2] = (((@49[0]*@49[2])*(1-@51))-(@49[1]*@52))))[1] = (((@49[0]*@49[1])*(1-@51))-(@49[2]*@52))))[3] = ((sq(@49[1])*(1-@51))+@51)))[5] = (((@49[1]*@49[2])*(1-@51))+(@49[0]*@52))))[2] = (((@49[0]*@49[2])*(1-@51))+(@49[1]*@52))))[5] = (((@49[1]*@49[2])*(1-@51))-(@49[0]*@52))))[8] = ((sq(@49[2])*(1-@51))+@51)),@46[:9]',zeros(3x3)),@38,zeros(3x3))',((zeros(3x1)[1] = -0.03)[2] = 0.05),zeros(3x1))), @54=(dense((project((zeros(3x1,1nz)[0] = @53[0]))[1] = @53[1]))[2] = @53[2]), @55=0.06, @56=(dot(@54, @1)-@55), @57=dot(zeros(3x1), @1), @58=1e-16, @59=(((81649.7*sqrt((sq(@56)*fabs(@56))))*(1-(7.5*@57)))*((@58+(0.5+(0.5*tanh((-(300*@56))))))*(0.5+(0.5*tanh((@58+(50*(0.133333-@57)))))))), @60=(-(@1*@57)), @61=(dense((project((zeros(3x1,1nz)[0] = @60[0]))[1] = @60[1]))[2] = @60[2]), @62=sqrt((1e-05+(||@61||_F*||@61||_F))), @63=(@62/0.01), @64=(-(@61*((((0.7*@59)*tanh((4*@63)))+(((0.1*@59)*@63)/((0.75+((0.25*@63)*@63))*(0.75+((0.25*@63)*@63)))))+((0.5*@59)*@62)))), @65=(@64[0] = (@64[0]/@62)), @66=(@65[1] = (@65[1]/@62)), @67=((@1*@59)+(@66[2] = (@66[2]/@62))), @68=(dense((project((zeros(3x1,1nz)[0] = @67[0]))[1] = @67[1]))[2] = @67[2]), @69=(@54+(@1*(dot(@54, @1)-@55))), @70=(-(dense((project((zeros(3x1,1nz)[0] = @69[0]))[1] = @69[1]))[2] = @69[2])), ((zeros(6x1)[:3] = (dense((project((zeros(3x1,1nz)[0] = ((@68[1]*@70[2])-(@68[2]*@70[1]))))[1] = ((@68[2]*@70[0])-(@68[0]*@70[2]))))[2] = ((@68[0]*@70[1])-(@68[1]*@70[0]))))[3:6] = @68))
# print(biorbd.SoftContactSphere(c).computeForceAtOrigin(m,q[:,0],qdot[:,0]).to_mx())
# @1=(zeros(3x1)[2] = 1), @2=(((zeros(3x1)[0] = -0.1)[1] = 0)[2] = 0), @3=cos(@2[0]), @4=sin(@2[0]), @5=cos(@2[1]), @6=sin(@2[1]), @7=cos(@2[2]), @8=sin(@2[2]), @9=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = @3))[5] = (-@4)))[2] = 0))[5] = @4))[8] = @3),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @5))[1] = 0))[2] = @6))[1] = 0))[3] = 1))[5] = 0))[2] = (-@6)))[5] = 0))[8] = @5),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @7))[1] = (-@8)))[2] = 0))[1] = @8))[3] = @7))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = (zeros(3x1)[2] = 0.8)), @10=@9[:9], @11=(dense((zeros(3x1,2nz)[1] = 1))[2] = 0), @12=(dense((project((zeros(6x1,4nz)[3] = @11[0]))[4] = @11[1]))[5] = @11[2]), @13=(dense((project((project((project((project((zeros(6x1,1nz)[0] = -0.085603))[1] = 0.606641))[2] = -0.0959401))[3] = 0.190916))[4] = -0.0248865))[5] = -0.645388), @14=(zeros(3x1)[2] = 1), @15=(dense((project((zeros(6x1,4nz)[3] = @14[0]))[4] = @14[1]))[5] = @14[2]), @16=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @17=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @16[0]))[1] = @16[1]))[2] = @16[2]))[3] = 0))[4] = 0))[5] = 0), @18=(dense((project((zeros(3x1,1nz)[0] = @17[0]))[1] = @17[1]))[2] = @17[2]), @19=@13[2], @20=cos(@19), @21=sin(@19), @22=mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@18[0])*(1-@20))+@20)))[1] = (((@18[1]*@18[0])*(1-@20))+(@18[2]*@21))))[2] = (((@18[0]*@18[2])*(1-@20))-(@18[1]*@21))))[1] = (((@18[0]*@18[1])*(1-@20))-(@18[2]*@21))))[3] = ((sq(@18[1])*(1-@20))+@20)))[5] = (((@18[1]*@18[2])*(1-@20))+(@18[0]*@21))))[2] = (((@18[0]*@18[2])*(1-@20))+(@18[1]*@21))))[5] = (((@18[1]*@18[2])*(1-@20))-(@18[0]*@21))))[8] = ((sq(@18[2])*(1-@20))+@20)),@10',zeros(3x3)), @23=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = ((zeros(3x1)[1] = 0.0406074)[2] = -0.104557)), @24=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @25=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @24[0]))[1] = @24[1]))[2] = @24[2]))[3] = 0))[4] = 0))[5] = 0), @26=(dense((project((zeros(3x1,1nz)[0] = @25[0]))[1] = @25[1]))[2] = @25[2]), @27=@13[3], @28=cos(@27), @29=sin(@27), @30=mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@26[0])*(1-@28))+@28)))[1] = (((@26[1]*@26[0])*(1-@28))+(@26[2]*@29))))[2] = (((@26[0]*@26[2])*(1-@28))-(@26[1]*@29))))[1] = (((@26[0]*@26[1])*(1-@28))-(@26[2]*@29))))[3] = ((sq(@26[1])*(1-@28))+@28)))[5] = (((@26[1]*@26[2])*(1-@28))+(@26[0]*@29))))[2] = (((@26[0]*@26[2])*(1-@28))+(@26[1]*@29))))[5] = (((@26[1]*@26[2])*(1-@28))-(@26[0]*@29))))[8] = ((sq(@26[2])*(1-@28))+@28)),@23[:9]',zeros(3x3)),@22,zeros(3x3)), @31=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = 1))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = (zeros(3x1)[2] = -0.462839)), @32=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @33=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @32[0]))[1] = @32[1]))[2] = @32[2]))[3] = 0))[4] = 0))[5] = 0), @34=(dense((project((zeros(3x1,1nz)[0] = @33[0]))[1] = @33[1]))[2] = @33[2]), @35=@13[4], @36=cos(@35), @37=sin(@35), @38=mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@34[0])*(1-@36))+@36)))[1] = (((@34[1]*@34[0])*(1-@36))+(@34[2]*@37))))[2] = (((@34[0]*@34[2])*(1-@36))-(@34[1]*@37))))[1] = (((@34[0]*@34[1])*(1-@36))-(@34[2]*@37))))[3] = ((sq(@34[1])*(1-@36))+@36)))[5] = (((@34[1]*@34[2])*(1-@36))+(@34[0]*@37))))[2] = (((@34[0]*@34[2])*(1-@36))+(@34[1]*@37))))[5] = (((@34[1]*@34[2])*(1-@36))-(@34[0]*@37))))[8] = ((sq(@34[2])*(1-@36))+@36)),@31[:9]',zeros(3x3)),@30,zeros(3x3)), @39=(((zeros(3x1)[0] = 1.5708)[1] = 0)[2] = 0), @40=cos(@39[0]), @41=sin(@39[0]), @42=cos(@39[1]), @43=sin(@39[1]), @44=cos(@39[2]), @45=sin(@39[2]), @46=(project((project(ones(4x4,4nz))[:9] = mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = 1))[1] = 0))[2] = 0))[1] = 0))[3] = @40))[5] = (-@41)))[2] = 0))[5] = @41))[8] = @40),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @42))[1] = 0))[2] = @43))[1] = 0))[3] = 1))[5] = 0))[2] = (-@43)))[5] = 0))[8] = @42),zeros(3x3)),(dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = @44))[1] = (-@45)))[2] = 0))[1] = @45))[3] = @44))[5] = 0))[2] = 0))[5] = 0))[8] = 1),zeros(3x3))))[9:12] = (zeros(3x1)[2] = -0.427481)), @47=(dense((project((zeros(3x1,1nz)[0] = 1))[1] = 0))[2] = 0), @48=(dense((project((project((project((project((zeros(6x1,1nz)[0] = @47[0]))[1] = @47[1]))[2] = @47[2]))[3] = 0))[4] = 0))[5] = 0), @49=(dense((project((zeros(3x1,1nz)[0] = @48[0]))[1] = @48[1]))[2] = @48[2]), @50=@13[5], @51=cos(@50), @52=sin(@50), @53=(((((((dense((project((zeros(3x1,1nz)[0] = @9[9]))[1] = @9[10]))[2] = @9[11])+mac(@10,(dense((project((zeros(3x1,1nz)[0] = (@12[3]*@13[0])))[1] = (@12[4]*@13[0])))[2] = (@12[5]*@13[0])),zeros(3x1)))+mac(@10,(dense((project((zeros(3x1,1nz)[0] = (@15[3]*@13[1])))[1] = (@15[4]*@13[1])))[2] = (@15[5]*@13[1])),zeros(3x1)))+mac(@22',(dense((project((zeros(3x1,1nz)[0] = @23[9]))[1] = @23[10]))[2] = @23[11]),zeros(3x1)))+mac(@30',(dense((project((zeros(3x1,1nz)[0] = @31[9]))[1] = @31[10]))[2] = @31[11]),zeros(3x1)))+mac(@38',(dense((project((zeros(3x1,1nz)[0] = @46[9]))[1] = @46[10]))[2] = @46[11]),zeros(3x1)))+mac(mac(mac((dense((project((project((project((project((project((project((project((zeros(3x3,1nz)[0] = ((sq(@49[0])*(1-@51))+@51)))[1] = (((@49[1]*@49[0])*(1-@51))+(@49[2]*@52))))[2] = (((@49[0]*@49[2])*(1-@51))-(@49[1]*@52))))[1] = (((@49[0]*@49[1])*(1-@51))-(@49[2]*@52))))[3] = ((sq(@49[1])*(1-@51))+@51)))[5] = (((@49[1]*@49[2])*(1-@51))+(@49[0]*@52))))[2] = (((@49[0]*@49[2])*(1-@51))+(@49[1]*@52))))[5] = (((@49[1]*@49[2])*(1-@51))-(@49[0]*@52))))[8] = ((sq(@49[2])*(1-@51))+@51)),@46[:9]',zeros(3x3)),@38,zeros(3x3))',((zeros(3x1)[1] = -0.03)[2] = 0.05),zeros(3x1))), @54=(dense((project((zeros(3x1,1nz)[0] = @53[0]))[1] = @53[1]))[2] = @53[2]), @55=0.06, @56=(dot(@54, @1)-@55), @57=dot(zeros(3x1), @1), @58=1e-16, @59=(((81649.7*sqrt((sq(@56)*fabs(@56))))*(1-(7.5*@57)))*((@58+(0.5+(0.5*tanh((-(300*@56))))))*(0.5+(0.5*tanh((@58+(50*(0.133333-@57)))))))), @60=(-(@1*@57)), @61=(dense((project((zeros(3x1,1nz)[0] = @60[0]))[1] = @60[1]))[2] = @60[2]), @62=sqrt((1e-05+(||@61||_F*||@61||_F))), @63=(@62/0.01), @64=(-(@61*((((0.7*@59)*tanh((4*@63)))+(((0.1*@59)*@63)/((0.75+((0.25*@63)*@63))*(0.75+((0.25*@63)*@63)))))+((0.5*@59)*@62)))), @65=(@64[0] = (@64[0]/@62)), @66=(@65[1] = (@65[1]/@62)), @67=((@1*@59)+(@66[2] = (@66[2]/@62))), @68=(dense((project((zeros(3x1,1nz)[0] = @67[0]))[1] = @67[1]))[2] = @67[2]), @69=(@54+(@1*(dot(@54, @1)-@55))), @70=(-(dense((project((zeros(3x1,1nz)[0] = @69[0]))[1] = @69[1]))[2] = @69[2])), ((zeros(6x1)[:3] = (dense((project((zeros(3x1,1nz)[0] = ((@68[1]*@70[2])-(@68[2]*@70[1]))))[1] = ((@68[2]*@70[0])-(@68[0]*@70[2]))))[2] = ((@68[0]*@70[1])-(@68[1]*@70[0]))))[3:6] = @68)
# )

        # ocp.add_plot_penalty(CostType.ALL)
